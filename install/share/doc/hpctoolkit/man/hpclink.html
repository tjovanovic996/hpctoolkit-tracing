<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- Manual page created with latex2man on Thu Aug  8 13:41:15 CDT 2019 --
-- Author of latex2man: Juergen.Vollmer@informatik-vollmer.de --
-- NOTE: This file is generated, DO NOT EDIT. -->
<html>
<head><title>HPCLINK</title></head>
<body bgcolor="white">
<h1 align=center>
hpclink 
</h1>
<h4 align=center>The HPCToolkit Performance Tools </h4>
<h4 align=center> 2018/07/10</h4>
<h4 align=center>Version develop</h4>
<p>
<tt>hpclink</tt>
is used to link <strong>HPCToolkit</strong>'s
performance measurement library (<a href="hpcrun.html"><em>hpcrun</em>(1)
</a>) into a statically linked application.
<p>
<h3>Table of Contents</h3>
<ul>
<li><a href="#section_1">Synopsis </a></li>
<li><a href="#section_2">Description </a></li>
<li><a href="#section_3">Arguments </a>
<ul>
<li><a href="#section_4">Options: Informational </a></li>
<li><a href="#section_5">Options: Linking </a></li>
</ul>
<li><a href="#section_6">Examples </a></li>
<li><a href="#section_7">Launching Static Programs </a></li>
<li><a href="#section_8">Notes </a></li>
<li><a href="#section_9">See Also </a></li>
<li><a href="#section_10">Version </a></li>
<li><a href="#section_11">License and Copyright </a></li>
<li><a href="#section_12">Authors </a></li>
</ul>
<p>
<h2><a name="section_1">Synopsis</a></h2>

<p>
<tt>hpclink</tt>
[<b>options</b>]
<i>link-command</i>
<p>
<h2><a name="section_2">Description</a></h2>

<p>
<tt>hpclink</tt>
is a wrapper around the system linker 
which injects the HPCToolkit performance measurement library 
when statically linking an application. 
If your application is statically linked you must use <tt>hopclink</tt>
at link time 
instead of <a href="hpcrun.html"><em>hpcrun</em>(1)
</a>at run time
because <tt>hpcrun</tt>'s
dynamic mechanism for injecting the library 
only works for dynamically linked applications. 
Although using <tt>hpclink</tt>
does require changing your link step, 
it does not require changes to your source code 
or to the way you compile individual files and libraries. 
<p>
To link with <tt>hpclink</tt>,
first locate the last step in your application's build system 
(the command that produces the final, statically linked binary). 
Then just use <tt>hpclink</tt>
instead of the system linker in that command. 
One simple way of accomplishing this is to prepend <tt>hpclink</tt>
to your makefile's link line. 
You may also wish to rename your binary (e.g. <tt>-o </tt><em>appname</em><tt>-hpclink</tt>}).
<p>
To control HPCToolkit's performance measurement during application execution, 
set one or more of the following environment variables: 
<p>
<ul compact>
<li><tt>HPCRUN_EVENT_LIST=&lt;event1&gt;[@&lt;period1&gt;];...;&lt;eventN&gt;[@&lt;periodN&gt;]</tt><br>
 
Sample using <i>event1</i>
through <i>eventN</i>
with their associated periods. 
Corresponds to <tt>hpcrun</tt>
option <tt>-e</tt>&nbsp;/&nbsp;<tt>--event</tt>.
<p>
</li>
<li><tt>HPCRUN_TRACE=1</tt><br>
 
Enable tracing, i.e. collection of data for <tt>hpctraceviewer</tt>.
Corresponds to <tt>hpcrun</tt>
option <tt>-t</tt>&nbsp;/&nbsp;<tt>--trace</tt>.
<p>
</li>
<li><tt>HPCRUN_PROCESS_FRACTION=&lt;frac&gt;</tt><br>
 
Measure only a fraction <i>frac</i>
of the execution's processses. 
For each process, enable measurement with probability <i>frac</i>,
a real number or fraction between 0 and 1. 
Corresponds to <tt>hpcrun</tt>
option <tt>-f</tt>&nbsp;/&nbsp;<tt>-fp</tt>&nbsp;/&nbsp;<tt>--process-fraction</tt>.
<p>
</li>
<li><tt>HPCRUN_OUT_PATH=&lt;outpath&gt;</tt><br>
 
Corresponds to <tt>hpcrun</tt>
option <tt>-o</tt>&nbsp;/&nbsp;<tt>--output</tt>.
<p>
</li>
</ul>
<p>
<h2><a name="section_3">Arguments</a></h2>

<p>
<dl compact>
<dt><i>link-command</i>
</dt>
<dd> The link command for producing a statically linked application binary. 
It typically has the following form:<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>compiler</i>
<i>[link-options]</i>
<i>object-files</i>
<i>libraries</i>
</dd>
</dl>
<p>
<h4><a name="section_4">Options: Informational</a></h4>

<p>
<dl compact>
<p>
<dt><b>-v</b>, <b>--verbose</b>
</dt>
<dd> 
Emit verbose messages: display both the original and the modified link command lines. 
<p>
</dd>
<dt><b>-V</b>, <b>--version</b>
</dt>
<dd> 
Print version information. 
<p>
</dd>
<dt><b>-h</b>, <b>--help</b>
</dt>
<dd> 
Print help. 
<p>
</dd>
</dl>
<p>
<h4><a name="section_5">Options: Linking</a></h4>

<p>
<dl compact>
<p>
<dt><b>-dw</b>, <b>--double-wrap</b>
</dt>
<dd> 
Double quote the linker wrap options introduced by <tt>hpclink</tt>,
i.e.emit <tt>-Wl,-Wl</tt>
instead of <tt>-Wl</tt>.
Use this to work around problems with the Berkeley UPC compiler script (rarely necessary). 
<p>
</dd>
<dt><b>-fe</b> <i>dir</i>, <b>--front-end</b> <i>dir</i>
</dt>
<dd> 
In a cross-compile link, 
use the current install tree for back-end libraries and 
use <i>dir</i>
for the install directory (prefix) of front-end tools (<tt>hpcfnbounds</tt>).
<p>
</dd>
<dt><b>--io</b>
</dt>
<dd> 
Include a library to track and report the number of io bytes read and written. 
<p>
</dd>
<dt><b>--ga</b>
</dt>
<dd> 
Include wrappers for the Global Arrays library. 
<p>
</dd>
<dt><b>--memleak</b>
</dt>
<dd> 
Include HPCToolkit's memory leak detection libraries. 
<p>
</dd>
<dt><b>--plugin</b> <i>name</i>
</dt>
<dd> 
Add the libraries and wrapped symbols specified by plugin <i>name</i>
in the plugins directory. 
<p>
</dd>
<dt><b>-u</b> <i>symbol</i>, <b>--undefined</b> <i>symbol</i>
</dt>
<dd> 
Pass <i>symbol</i>
to the linker as an undefined symbol. 
This option is rarely needed, 
but if <tt>hpclink</tt>
fails with an undefined reference to <tt>__real_foo</tt>
then the option ``<tt>-u foo</tt>''
may induce the linker to correctly link this symbol. 
May be used multiple times. 
<p>
</dd>
</dl>
<p>
<h2><a name="section_6">Examples</a></h2>

<p>
Compile the "hello, world" program with <tt>gcc</tt>
and link in the 
<tt>hpcrun</tt>
code statically. 
<p>
<pre>
    hpclink gcc -o hello -g -O -static hello.c
</pre>
Link an <tt>hpcrun</tt>-enabled
application from object files and the 
math library. 
<p>
<pre>
    hpclink gcc -o myprog -static main.o foo.o ... -lm
</pre>
Make both native and <tt>hpcrun</tt>-enabled
versions of an application from object files and system libraries with the <tt>mpixlc</tt>
compiler. 
Note that the argument list to the <tt>hpclink</tt>
command is exactly the command to build the native version except for the name of the output file. 
<p>
<pre>
    mpixlc -o myprog main.o foo.o ... -lm -lpthread
    hpclink mpixlc -o myprog.hpc main.o foo.o ... -lm -lpthread
</pre>
<p>
<h2><a name="section_7">Launching Static Programs</a></h2>

<p>
For dynamically linked binaries, the <tt>hpcrun</tt>
script is used to launch programs and set environment variables, but on systems with separate compute nodes, this is often not available. 
In this case, the <tt>HPCRUN_EVENT_LIST</tt>
environment variable is used to pass the profiling events to the <tt>hpcrun</tt>
code. 
<p>
<pre>
    export HPCRUN_EVENT_LIST="PAPI_TOT_CYC@4000000"
    myprog arg ...
</pre>
For example, on a Cray XT system, you might launch a job with a PBS 
script such as the following. 
<p>
<pre>
    #!/bin/sh
    #PBS -l size=64
    #PBS -l walltime=01:00:00
    cd $PBS_O_WORKDIR
    export HPCRUN_EVENT_LIST="PAPI_TOT_CYC@4000000 PAPI_L2_TCM@400000"
    aprun -n 64 ./myprog arg ...
</pre>
The IBM Blue Gene system uses the <tt>--env</tt>
option to pass 
environment variables, so you might launch a job with a command 
such as the following. 
<p>
<pre>
    qsub -t 60 -n 64 --env HPCRUN_EVENT_LIST="WALLCLOCK@1000" \
        /path/to/myprog arg ...
</pre>
<p>
<h2><a name="section_8">Notes</a></h2>

<p>
The command line passed to <tt>hpclink</tt>
must produce a statically linked binary and the <tt>hpclink</tt>
script will fail if it does not. 
<p>
With some compilers, e.g. IBM's XL family, 
interprocedural optimization interferes with <tt>hpclink</tt>
and causes failure. 
If this occurs interprocedural optimization must be disabled. 
All other optimizations can remain enabled. 
<p>
<h2><a name="section_9">See Also</a></h2>

<p>
<a href="hpctoolkit.html"><em>hpctoolkit</em>(1)
</a>.<br>

<a href="hpcrun.html"><em>hpcrun</em>(1)
</a>.
<p>
<h2><a name="section_10">Version</a></h2>

<p>
Version: develop
<p>
<h2><a name="section_11">License and Copyright</a></h2>

<p>
<dl compact>
<dt>Copyright</dt>
<dd> &copy; 2002-2019, Rice University. 
</dd>
<dt>License</dt>
<dd> See <tt>README.License</tt>.
</dd>
</dl>
<p>
<h2><a name="section_12">Authors</a></h2>

<p>
Mark Krentel <br>

Rice HPCToolkit Research Group <br>

Email: <a href ="mailto:hpctoolkit-forum =at= rice.edu"><tt>hpctoolkit-forum =at= rice.edu</tt></a>
<br>
WWW: <a href ="http://hpctoolkit.org"><tt>http://hpctoolkit.org</tt></a>.
<p>
</body>
</html>
<!-- NOTE: This file is generated, DO NOT EDIT. -->
